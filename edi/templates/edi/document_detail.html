{% extends 'edi/base.html' %}
{% load edi_tags %}
{% block title %}{{ doc }} ‚Äî Docrobot EDI{% endblock %}
{% block page_title %}{{ doc.get_doc_type_display }} ‚Ññ{{ doc.number }}{% endblock %}
{% block page_sub %}Docrobot ID: {{ doc.docrobot_id }}{% endblock %}

{% block topbar_actions %}
{% if queue and queue.status != 'sent' %}
<button class="btn btn-warn" onclick="retryQueue({{ queue.id }}, this)">‚Ü∫ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É</button>
{% endif %}
{% if queue and queue.status == 'failed' or not queue %}
<button class="btn btn-primary" onclick="sendDoc({{ doc.pk }}, this)">‚Üí –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ 1–°</button>
{% endif %}
{% endblock %}

{% block content %}
<div class="detail-grid">

  <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è + XML -->
  <div style="display:flex;flex-direction:column;gap:16px;">

    <!-- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ -->
    <div class="card">
      <div class="card-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ–∫—É–º–µ–Ω—Ç–µ</div>
      <table class="meta-table" style="width:100%">
        <tr><td>–¢–∏–ø</td><td><span class="badge badge-{{ doc.doc_type }}">{{ doc.get_doc_type_display }}</span></td></tr>
        <tr><td>–ù–æ–º–µ—Ä</td><td class="td-mono">{{ doc.number|default:"‚Äî" }}</td></tr>
        <tr><td>–î–∞—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞</td><td class="td-mono">{{ doc.doc_date|default:"‚Äî" }}</td></tr>
        <tr><td>–ü–æ–ª—É—á–µ–Ω</td><td class="td-mono">{{ doc.received_at|date:"d.m.Y H:i:s" }}</td></tr>
        <tr><td>–ü–æ—Å—Ç–∞–≤—â–∏–∫ (GLN)</td><td class="td-mono">{{ doc.supplier_name }} <span style="color:var(--text3)">[{{ doc.supplier_gln }}]</span></td></tr>
        <tr><td>–ü–æ–∫—É–ø–∞—Ç–µ–ª—å (GLN)</td><td class="td-mono">{{ doc.buyer_name }} <span style="color:var(--text3)">[{{ doc.buyer_gln }}]</span></td></tr>
        <tr><td>Docrobot ID</td><td class="td-mono" style="font-size:10px;">{{ doc.docrobot_id }}</td></tr>
      </table>
    </div>

    <!-- –ü–æ–∑–∏—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ -->
    {% if positions %}
    <div class="card">
      <div class="flex-between mb16">
        <div class="card-title" style="margin:0">üì¶ –¢–æ–≤–∞—Ä–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ <span style="font-size:12px;color:var(--muted);font-weight:400">({{ positions|length }} —à—Ç.)</span></div>
        <div style="font-size:12px;color:var(--muted)">
          –°—É–º–º–∞: <strong style="color:var(--text)">{{ total_amount|default:"‚Äî" }}</strong>
        </div>
      </div>
      <div style="overflow-x:auto">
      <table style="width:100%;border-collapse:collapse;font-size:12px">
        <thead>
          <tr style="background:var(--surface2)">
            <th style="padding:8px 10px;text-align:left;border-bottom:1px solid var(--border);font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px">#</th>
            <th style="padding:8px 10px;text-align:left;border-bottom:1px solid var(--border);font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px">EAN / –ö–æ–¥</th>
            <th style="padding:8px 10px;text-align:left;border-bottom:1px solid var(--border);font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
            <th style="padding:8px 10px;text-align:right;border-bottom:1px solid var(--border);font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px">–ö–æ–ª-–≤–æ</th>
            <th style="padding:8px 10px;text-align:left;border-bottom:1px solid var(--border);font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px">–ï–¥.</th>
            <th style="padding:8px 10px;text-align:right;border-bottom:1px solid var(--border);font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px">–¶–µ–Ω–∞</th>
            <th style="padding:8px 10px;text-align:right;border-bottom:1px solid var(--border);font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px">–°—É–º–º–∞ —Å –ù–î–°</th>
          </tr>
        </thead>
        <tbody>
  {% for pos in positions %}
  <tr style="{% cycle '' 'background:var(--surface2)' %}">
    <td style="padding:8px 10px;border-bottom:1px solid var(--border);color:var(--muted)">
        {{ forloop.counter }}
    </td>

    <td style="padding:8px 10px;border-bottom:1px solid var(--border);font-family:monospace;font-size:11px">
        {{ pos.ean|default:"‚Äî" }}
    </td>

    <td style="padding:8px 10px;border-bottom:1px solid var(--border);font-weight:500">
        {{ pos.name|default:"‚Äî" }}
    </td>

    <td style="padding:8px 10px;border-bottom:1px solid var(--border);text-align:right">
        {{ pos.qty|default:0 }}
    </td>

    <td style="padding:8px 10px;border-bottom:1px solid var(--border);color:var(--muted)">
        {{ pos.unit|default:"—à—Ç" }}
    </td>

    <td style="padding:8px 10px;border-bottom:1px solid var(--border);text-align:right;font-family:monospace">
        {{ pos.price|floatformat:2|default:"‚Äî" }}
    </td>

    <!-- ‚úÖ –°—á–∏—Ç–∞–µ–º —Å—É–º–º—É —Å –ù–î–° –ø—Ä—è–º–æ –∑–¥–µ—Å—å -->
    <td style="padding:8px 10px;border-bottom:1px solid var(--border);text-align:right;font-family:monospace;font-weight:600">
        {% if pos.qty and pos.price %}
            {{ pos.qty|floatformat:2|add:"0"|floatformat:2 }}
            √ó
            {{ pos.price|floatformat:2 }}
            =
            {{ pos.qty|floatformat:2|add:"0"|floatformat:2|floatformat:2 }}
        {% else %}
            ‚Äî
        {% endif %}
    </td>

  </tr>
  {% endfor %}
</tbody>        <tfoot>
          <tr style="background:rgba(59,130,246,.05)">
            <td colspan="6" style="padding:10px;text-align:right;font-weight:700;font-size:13px">–ò–¢–û–ì–û:</td>
            <td style="padding:10px;text-align:right;font-weight:700;font-size:13px;font-family:monospace;color:var(--accent)">
              {{ total_amount|floatformat:2|default:"‚Äî" }}
            </td>
          </tr>
        </tfoot>
      </table>
      </div>
    </div>
    {% endif %}

    <!-- XML-–ø—Ä–æ—Å–º–æ—Ç—Ä -->
    <div class="card">
      <div class="flex-between mb16">
        <div class="card-title" style="margin:0">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π XML</div>
        <button class="btn btn-secondary btn-sm" onclick="copyXml()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
      </div>
      {% if doc.xml_content %}
      <div class="code-block" id="xml-content">{{ doc.xml_content }}</div>
      {% else %}
      <div class="empty"><div class="empty-icon">üìÑ</div><p>XML –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω</p></div>
      {% endif %}
    </div>

    <!-- –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ Docrobot -->
    <div class="card">
      <div class="card-title">–°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ Docrobot (JSON)</div>
      <div class="code-block" style="color:#86efac;">{{ doc.raw_json|json_dumps }}</div>
    </div>

  </div>

  <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –æ—á–µ—Ä–µ–¥—å + –ª–æ–≥–∏ -->
  <div style="display:flex;flex-direction:column;gap:16px;">

    <!-- –°—Ç–∞—Ç—É—Å –æ—á–µ—Ä–µ–¥–∏ -->
    <div class="card">
      <div class="card-title">–°—Ç–∞—Ç—É—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ 1–°</div>
      {% if queue %}
      <div style="margin-bottom:12px;">
        <span class="badge badge-{{ queue.status }}" style="font-size:13px;padding:4px 12px;">{{ queue.get_status_display }}</span>
      </div>
      <table class="meta-table" style="width:100%">
        <tr><td>–ü–æ–ø—ã—Ç–æ–∫</td><td class="td-mono">{{ queue.attempts }}</td></tr>
        <tr><td>–°–æ–∑–¥–∞–Ω</td><td class="td-mono">{{ queue.created_at|date:"d.m.Y H:i" }}</td></tr>
        <tr><td>–û–±–Ω–æ–≤–ª—ë–Ω</td><td class="td-mono">{{ queue.updated_at|date:"d.m.Y H:i" }}</td></tr>
        {% if queue.sent_at %}
        <tr><td>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω</td><td class="td-mono" style="color:var(--accent2)">{{ queue.sent_at|date:"d.m.Y H:i" }}</td></tr>
        {% endif %}
        {% if queue.http_status %}
        <tr><td>HTTP-–∫–æ–¥</td><td class="td-mono">{{ queue.http_status }}</td></tr>
        {% endif %}
        {% if queue.next_retry %}
        <tr><td>–°–ª–µ–¥—É—é—â–∞—è –ø–æ–ø—ã—Ç–∫–∞</td><td class="td-mono" style="color:var(--warn)">{{ queue.next_retry|date:"d.m H:i" }}</td></tr>
        {% endif %}
      </table>
      {% if queue.last_error %}
      <div style="margin-top:12px;padding:10px;background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.2);border-radius:6px;font-size:12px;color:var(--danger);font-family:var(--mono);">
        {{ queue.last_error }}
      </div>
      {% endif %}
      {% if queue.response %}
      <div style="margin-top:10px;">
        <div style="font-size:11px;color:var(--text3);margin-bottom:4px;">–û—Ç–≤–µ—Ç 1–°:</div>
        <div class="code-block" style="max-height:120px;">{{ queue.response }}</div>
      </div>
      {% endif %}
      {% else %}
      <div style="color:var(--text3);font-size:13px;">–î–æ–∫—É–º–µ–Ω—Ç –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –æ—á–µ—Ä–µ–¥—å</div>
      {% endif %}
    </div>

    <!-- ‚îÄ‚îÄ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ‚îÄ‚îÄ -->
    <div class="card" id="comments-card">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
        <div class="card-title" style="margin:0">
          üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
          <span id="comment-count" style="font-size:12px;color:var(--muted);font-weight:400">
            ({{ comments|length }})
          </span>
        </div>
        <button class="btn btn-secondary btn-sm" onclick="toggleCommentForm()">+ –î–æ–±–∞–≤–∏—Ç—å</button>
      </div>

      <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
      <div id="comment-form" style="display:none;margin-bottom:14px;padding:14px;background:var(--surface2);border-radius:8px;border:1px solid var(--border)">
        <div style="display:flex;gap:8px;margin-bottom:10px">
          <input type="text" id="comment-author" placeholder="–í–∞—à–µ –∏–º—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"
                 style="flex:1;padding:7px 10px;font-size:12px;background:var(--surface);border:1px solid var(--border);border-radius:6px;color:var(--text);outline:none">
          <select id="comment-importance"
                  style="padding:7px 10px;font-size:12px;background:var(--surface);border:1px solid var(--border);border-radius:6px;color:var(--text);outline:none">
            <option value="normal">‚ö™ –û–±—ã—á–Ω—ã–π</option>
            <option value="warn">üü° –í–Ω–∏–º–∞–Ω–∏–µ</option>
            <option value="urgent">üî¥ –°—Ä–æ—á–Ω–æ</option>
          </select>
        </div>
        <textarea id="comment-text" rows="3" placeholder="–¢–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è..."
                  style="width:100%;padding:8px 10px;font-size:13px;background:var(--surface);border:1px solid var(--border);border-radius:6px;color:var(--text);outline:none;resize:vertical;box-sizing:border-box"></textarea>
        <div style="display:flex;gap:8px;margin-top:10px;justify-content:flex-end">
          <button class="btn btn-secondary btn-sm" onclick="toggleCommentForm()">–û—Ç–º–µ–Ω–∞</button>
          <button class="btn btn-primary btn-sm" onclick="submitComment({{ doc.pk }})">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
      </div>

      <!-- –°–ø–∏—Å–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
      <div id="comments-list">
        {% for c in comments %}
        <div class="comment-item" data-id="{{ c.pk }}"
             style="padding:10px 12px;border-radius:8px;margin-bottom:8px;border-left:3px solid
             {% if c.importance == 'urgent' %}#EF4444{% elif c.importance == 'warn' %}#F59E0B{% else %}var(--border){% endif %};
             background:{% if c.importance == 'urgent' %}rgba(239,68,68,.06){% elif c.importance == 'warn' %}rgba(245,158,11,.06){% else %}var(--surface2){% endif %}">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px">
            <div style="display:flex;align-items:center;gap:8px">
              <span style="font-size:11px;font-weight:700;color:var(--text)">{{ c.author|default:"–û–ø–µ—Ä–∞—Ç–æ—Ä" }}</span>
              <span style="font-size:10px;color:var(--muted)">{{ c.created_at|date:"d.m.Y H:i" }}</span>
              {% if c.importance == 'urgent' %}
              <span style="font-size:10px;background:#FEE2E2;color:#DC2626;padding:1px 6px;border-radius:4px;font-weight:700">üî¥ –°–†–û–ß–ù–û</span>
              {% elif c.importance == 'warn' %}
              <span style="font-size:10px;background:#FEF3C7;color:#D97706;padding:1px 6px;border-radius:4px;font-weight:700">üü° –í–ù–ò–ú–ê–ù–ò–ï</span>
              {% endif %}
            </div>
            <button onclick="deleteComment({{ c.pk }}, this)"
                    style="background:none;border:none;cursor:pointer;font-size:14px;color:var(--muted);padding:2px 6px;border-radius:4px"
                    title="–£–¥–∞–ª–∏—Ç—å">‚úï</button>
          </div>
          <div style="font-size:13px;color:var(--text);white-space:pre-wrap">{{ c.text }}</div>
        </div>
        {% empty %}
        <div id="no-comments" style="color:var(--muted);font-size:13px;text-align:center;padding:20px 0">
          –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –Ω–µ—Ç
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- –õ–æ–≥–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ -->
    <div class="card">
      <div class="card-title">–ò—Å—Ç–æ—Ä–∏—è —Å–æ–±—ã—Ç–∏–π</div>
      {% if logs %}
      {% for log in logs %}
      <div style="padding:8px 0;border-bottom:1px solid var(--border);">
        <div class="flex-between">
          <span class="badge badge-{% if log.level == 'error' %}error-lvl{% elif log.level == 'warn' %}warn{% else %}info{% endif %}" style="font-size:10px;">{{ log.action }}</span>
          <span class="td-mono" style="font-size:10px;">{{ log.created_at|date:"d.m H:i:s" }}</span>
        </div>
        <div style="font-size:12px;color:var(--text2);margin-top:4px;">{{ log.message }}</div>
      </div>
      {% endfor %}
      {% else %}
      <div style="color:var(--text3);font-size:13px;">–°–æ–±—ã—Ç–∏–π –Ω–µ—Ç</div>
      {% endif %}
    </div>

  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function copyXml() {  const text = document.getElementById('xml-content').textContent;
  navigator.clipboard.writeText(text).then(() => toast('XML —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω', 'success'));
}

async function sendDoc(id, btn) {
  btn.disabled = true;
  btn.textContent = '...';
  try {
    const r = await fetch(`/api/send/${id}/`, {
      method: 'POST',
      headers: { 'X-CSRFToken': getCookie('csrftoken') },
    });
    const d = await r.json();
    if (d.success) {
      toast('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ', 'success');
      setTimeout(() => location.reload(), 1000);
    } else {
      toast(`–û—à–∏–±–∫–∞: ${d.error}`, 'error');
      btn.disabled = false;
      btn.textContent = '‚Üí –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ 1–°';
    }
  } catch(e) { toast('–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞', 'error'); btn.disabled = false; }
}

// ‚îÄ‚îÄ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleCommentForm() {
  const f = document.getElementById('comment-form');
  f.style.display = f.style.display === 'none' ? 'block' : 'none';
  if (f.style.display === 'block') document.getElementById('comment-text').focus();
}

async function submitComment(docId) {
  const text       = document.getElementById('comment-text').value.trim();
  const author     = document.getElementById('comment-author').value.trim();
  const importance = document.getElementById('comment-importance').value;
  if (!text) { toast('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è', 'error'); return; }

  const fd = new FormData();
  fd.append('text', text); fd.append('author', author); fd.append('importance', importance);
  fd.append('csrfmiddlewaretoken', getCookie('csrftoken'));

  try {
    const r = await fetch(`/api/comments/${docId}/add/`, {method:'POST', body: fd});
    const d = await r.json();
    if (d.ok) {
      addCommentToDOM(d);
      document.getElementById('comment-text').value = '';
      toggleCommentForm();
      toast('–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–æ–±–∞–≤–ª–µ–Ω', 'success');
      const cnt = document.getElementById('comment-count');
      if (cnt) {
        const n = document.querySelectorAll('.comment-item').length;
        cnt.textContent = `(${n})`;
      }
    } else {
      toast(d.error || '–û—à–∏–±–∫–∞', 'error');
    }
  } catch(e) { toast('–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞', 'error'); }
}

function addCommentToDOM(d) {
  const noComments = document.getElementById('no-comments');
  if (noComments) noComments.remove();

  const BORDER = d.importance === 'urgent' ? '#EF4444' : d.importance === 'warn' ? '#F59E0B' : 'var(--border)';
  const BG     = d.importance === 'urgent' ? 'rgba(239,68,68,.06)' : d.importance === 'warn' ? 'rgba(245,158,11,.06)' : 'var(--surface2)';
  const BADGE  = d.importance === 'urgent'
    ? '<span style="font-size:10px;background:#FEE2E2;color:#DC2626;padding:1px 6px;border-radius:4px;font-weight:700">üî¥ –°–†–û–ß–ù–û</span>'
    : d.importance === 'warn'
    ? '<span style="font-size:10px;background:#FEF3C7;color:#D97706;padding:1px 6px;border-radius:4px;font-weight:700">üü° –í–ù–ò–ú–ê–ù–ò–ï</span>'
    : '';

  const el = document.createElement('div');
  el.className = 'comment-item';
  el.dataset.id = d.id;
  el.style.cssText = `padding:10px 12px;border-radius:8px;margin-bottom:8px;border-left:3px solid ${BORDER};background:${BG}`;
  el.innerHTML = `
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px">
      <div style="display:flex;align-items:center;gap:8px">
        <span style="font-size:11px;font-weight:700;color:var(--text)">${d.author || '–û–ø–µ—Ä–∞—Ç–æ—Ä'}</span>
        <span style="font-size:10px;color:var(--muted)">${d.created_at}</span>
        ${BADGE}
      </div>
      <button onclick="deleteComment(${d.id}, this)"
              style="background:none;border:none;cursor:pointer;font-size:14px;color:var(--muted);padding:2px 6px;border-radius:4px" title="–£–¥–∞–ª–∏—Ç—å">‚úï</button>
    </div>
    <div style="font-size:13px;color:var(--text);white-space:pre-wrap">${d.text.replace(/</g,'&lt;')}</div>`;

  const list = document.getElementById('comments-list');
  list.insertBefore(el, list.firstChild);
}

async function deleteComment(id, btn) {
  if (!confirm('–£–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π?')) return;
  const fd = new FormData();
  fd.append('csrfmiddlewaretoken', getCookie('csrftoken'));
  try {
    const r = await fetch(`/api/comments/${id}/delete/`, {method:'POST', body: fd});
    const d = await r.json();
    if (d.ok) {
      btn.closest('.comment-item').remove();
      const cnt = document.getElementById('comment-count');
      if (cnt) {
        const n = document.querySelectorAll('.comment-item').length;
        cnt.textContent = `(${n})`;
        if (n === 0) {
          document.getElementById('comments-list').innerHTML =
            '<div id="no-comments" style="color:var(--muted);font-size:13px;text-align:center;padding:20px 0">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –Ω–µ—Ç</div>';
        }
      }
      toast('–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —É–¥–∞–ª—ë–Ω', 'info');
    }
  } catch(e) { toast('–û—à–∏–±–∫–∞', 'error'); }
}
</script>

{% endblock %}
