<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}Docrobot EDI Gateway{% endblock %}</title>
  <style>
    /* ‚îÄ‚îÄ –®—Ä–∏—Ñ—Ç—ã ‚îÄ‚îÄ */
    @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=IBM+Plex+Sans:wght@300;400;500;600;700&display=swap');

    /* ‚îÄ‚îÄ CSS-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ‚îÄ‚îÄ */
    :root {
      --bg:      #0b0f1a;
      --surface: #111827;
      --surface2:#1a2236;
      --surface3:#202d44;
      --border:  #1e2d45;
      --text:    #e2e8f0;
      --text2:   #94a3b8;
      --text3:   #4b6080;
      --accent:  #3b82f6;
      --accent2: #10b981;
      --warn:    #f59e0b;
      --danger:  #ef4444;
      --purple:  #8b5cf6;
      --mono:    'IBM Plex Mono', monospace;
      --sans:    'IBM Plex Sans', sans-serif;
      --nav-w:   220px;
      --radius:  8px;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: var(--sans); background: var(--bg); color: var(--text); min-height: 100vh; display: flex; font-size: 14px; }

    /* ‚îÄ‚îÄ –ù–∞–≤–∏–≥–∞—Ü–∏—è ‚îÄ‚îÄ */
    .nav {
      width: var(--nav-w); min-height: 100vh; background: var(--surface);
      border-right: 1px solid var(--border); display: flex; flex-direction: column;
      position: fixed; top: 0; left: 0; z-index: 100;
    }
    .nav-logo {
      padding: 20px 16px 16px;
      border-bottom: 1px solid var(--border);
    }
    .nav-logo-title {
      font-family: var(--mono); font-size: 13px; font-weight: 600;
      color: var(--accent); letter-spacing: 0.08em;
    }
    .nav-logo-sub {
      font-size: 10px; color: var(--text3); margin-top: 2px; font-family: var(--mono);
    }
    .nav-items { flex: 1; padding: 12px 8px; overflow-y: auto; }
    .nav-section { margin-bottom: 16px; }
    .nav-label {
      font-size: 9px; font-weight: 600; letter-spacing: 0.12em;
      color: var(--text3); padding: 0 8px; margin-bottom: 4px; text-transform: uppercase;
    }
    .nav-item {
      display: flex; align-items: center; gap: 9px; padding: 8px 10px;
      border-radius: 6px; color: var(--text2); font-size: 13px; font-weight: 500;
      cursor: pointer; transition: all 0.15s; text-decoration: none;
    }
    .nav-item:hover { background: var(--surface2); color: var(--text); }
    .nav-item.active { background: rgba(59,130,246,0.15); color: var(--accent); }
    .nav-icon { font-size: 15px; width: 18px; text-align: center; flex-shrink: 0; }
    .nav-footer {
      padding: 12px 16px; border-top: 1px solid var(--border);
      font-size: 11px; color: var(--text3); font-family: var(--mono);
    }

    /* ‚îÄ‚îÄ –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç ‚îÄ‚îÄ */
    .main { margin-left: var(--nav-w); flex: 1; min-height: 100vh; display: flex; flex-direction: column; }
    .topbar {
      padding: 14px 28px; background: var(--surface); border-bottom: 1px solid var(--border);
      display: flex; align-items: center; justify-content: space-between; flex-shrink: 0;
    }
    .topbar-title { font-size: 16px; font-weight: 600; }
    .topbar-sub { font-size: 12px; color: var(--text3); margin-top: 1px; }
    .topbar-right { display: flex; align-items: center; gap: 12px; }
    .content { padding: 24px 28px; flex: 1; }

    /* ‚îÄ‚îÄ –ö–∞—Ä—Ç–æ—á–∫–∏ ‚îÄ‚îÄ */
    .card {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: var(--radius); padding: 20px;
    }
    .card-title { font-size: 12px; font-weight: 600; color: var(--text2); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 12px; }

    /* ‚îÄ‚îÄ Stat cards ‚îÄ‚îÄ */
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 14px; margin-bottom: 24px; }
    .stat-card {
      background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius);
      padding: 16px; position: relative; overflow: hidden;
    }
    .stat-card::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
      background: var(--accent-color, var(--accent));
    }
    .stat-label { font-size: 11px; color: var(--text3); font-weight: 500; text-transform: uppercase; letter-spacing: 0.06em; }
    .stat-value { font-size: 28px; font-weight: 700; color: var(--text); margin: 6px 0 2px; font-family: var(--mono); }
    .stat-value.green  { color: var(--accent2); }
    .stat-value.blue   { color: var(--accent); }
    .stat-value.warn   { color: var(--warn); }
    .stat-value.red    { color: var(--danger); }

    /* ‚îÄ‚îÄ –¢–∞–±–ª–∏—Ü—ã ‚îÄ‚îÄ */
    .table-wrap {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: var(--radius); overflow: hidden;
    }
    .table-toolbar {
      padding: 12px 16px; border-bottom: 1px solid var(--border);
      display: flex; gap: 10px; align-items: center; flex-wrap: wrap;
    }
    table { width: 100%; border-collapse: collapse; }
    th {
      text-align: left; padding: 10px 14px; font-size: 10px;
      font-weight: 600; text-transform: uppercase; letter-spacing: 0.08em;
      color: var(--text3); border-bottom: 1px solid var(--border);
      background: var(--surface2);
    }
    td { padding: 10px 14px; font-size: 13px; border-bottom: 1px solid rgba(30,45,69,0.6); }
    tr:last-child td { border-bottom: none; }
    tr:hover td { background: rgba(30,45,69,0.4); }
    .td-mono { font-family: var(--mono); font-size: 11px; color: var(--text2); }

    /* ‚îÄ‚îÄ –ë–µ–π–¥–∂–∏ ‚îÄ‚îÄ */
    .badge {
      display: inline-flex; align-items: center; gap: 4px;
      padding: 2px 8px; border-radius: 20px; font-size: 11px; font-weight: 600;
    }
    .badge-pending  { background: rgba(148,163,184,0.12); color: var(--text2); border: 1px solid rgba(148,163,184,0.2); }
    .badge-sending  { background: rgba(59,130,246,0.12);  color: var(--accent);  border: 1px solid rgba(59,130,246,0.2); }
    .badge-sent     { background: rgba(16,185,129,0.12);  color: var(--accent2); border: 1px solid rgba(16,185,129,0.2); }
    .badge-error    { background: rgba(245,158,11,0.12);  color: var(--warn);    border: 1px solid rgba(245,158,11,0.2); }
    .badge-failed   { background: rgba(239,68,68,0.12);   color: var(--danger);  border: 1px solid rgba(239,68,68,0.2); }
    .badge-ORDER    { background: rgba(59,130,246,0.12);  color: var(--accent);  border: 1px solid rgba(59,130,246,0.2); }
    .badge-ORDRSP   { background: rgba(139,92,246,0.12);  color: var(--purple);  border: 1px solid rgba(139,92,246,0.2); }
    .badge-DESADV   { background: rgba(245,158,11,0.12);  color: var(--warn);    border: 1px solid rgba(245,158,11,0.2); }
    .badge-INVOICE  { background: rgba(16,185,129,0.12);  color: var(--accent2); border: 1px solid rgba(16,185,129,0.2); }
    .badge-PRICAT   { background: rgba(148,163,184,0.12); color: var(--text2);   border: 1px solid rgba(148,163,184,0.2); }
    .badge-info     { background: rgba(59,130,246,0.12);  color: var(--accent); }
    .badge-warn     { background: rgba(245,158,11,0.12);  color: var(--warn); }
    .badge-error-lvl{ background: rgba(239,68,68,0.12);   color: var(--danger); }

    /* ‚îÄ‚îÄ –ö–Ω–æ–ø–∫–∏ ‚îÄ‚îÄ */
    .btn {
      display: inline-flex; align-items: center; gap: 6px; padding: 7px 14px;
      border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;
      border: 1px solid transparent; transition: all 0.15s; font-family: var(--sans);
    }
    .btn-primary { background: var(--accent); color: #fff; border-color: var(--accent); }
    .btn-primary:hover { background: #2563eb; }
    .btn-secondary { background: var(--surface2); color: var(--text2); border-color: var(--border); }
    .btn-secondary:hover { background: var(--surface3); color: var(--text); }
    .btn-success { background: rgba(16,185,129,0.15); color: var(--accent2); border-color: rgba(16,185,129,0.3); }
    .btn-success:hover { background: rgba(16,185,129,0.25); }
    .btn-danger { background: rgba(239,68,68,0.1); color: var(--danger); border-color: rgba(239,68,68,0.3); }
    .btn-danger:hover { background: rgba(239,68,68,0.2); }
    .btn-warn { background: rgba(245,158,11,0.1); color: var(--warn); border-color: rgba(245,158,11,0.3); }
    .btn-sm { padding: 4px 10px; font-size: 11px; }

    /* ‚îÄ‚îÄ –§–æ—Ä–º—ã ‚îÄ‚îÄ */
    input[type=text], input[type=date], input[type=search], select, textarea {
      background: var(--surface2); border: 1px solid var(--border); border-radius: 6px;
      color: var(--text); padding: 7px 10px; font-size: 12px; font-family: var(--sans);
      outline: none; transition: border-color 0.15s;
    }
    input:focus, select:focus, textarea:focus { border-color: var(--accent); }
    select option { background: var(--surface2); }

    /* ‚îÄ‚îÄ –°–µ—Ç–∫–∏ ‚îÄ‚îÄ */
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
    .flex-row { display: flex; gap: 12px; align-items: center; }
    .flex-between { display: flex; justify-content: space-between; align-items: center; }
    .mb16 { margin-bottom: 16px; }
    .mb24 { margin-bottom: 24px; }

    /* ‚îÄ‚îÄ –ö–æ–¥ (XML) ‚îÄ‚îÄ */
    .code-block {
      background: #070c15; border: 1px solid var(--border); border-radius: var(--radius);
      padding: 16px; font-family: var(--mono); font-size: 12px; color: #a5f3fc;
      overflow-x: auto; white-space: pre; max-height: 400px; overflow-y: auto;
    }

    /* ‚îÄ‚îÄ Toast ‚îÄ‚îÄ */
    #toast-container { position: fixed; bottom: 24px; right: 24px; z-index: 9999; display: flex; flex-direction: column; gap: 8px; }
    .toast {
      padding: 10px 16px; border-radius: 8px; font-size: 13px; font-weight: 500;
      display: flex; align-items: center; gap: 8px;
      animation: slideIn 0.2s ease; min-width: 200px;
    }
    .toast-success { background: rgba(16,185,129,0.15); border: 1px solid rgba(16,185,129,0.3); color: var(--accent2); }
    .toast-error   { background: rgba(239,68,68,0.15); border: 1px solid rgba(239,68,68,0.3); color: var(--danger); }
    .toast-info    { background: rgba(59,130,246,0.15); border: 1px solid rgba(59,130,246,0.3); color: var(--accent); }
    @keyframes slideIn { from { transform: translateX(40px); opacity:0; } to { transform:none; opacity:1; } }

    /* ‚îÄ‚îÄ –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ ‚îÄ‚îÄ */
    .empty { padding: 40px; text-align: center; color: var(--text3); }
    .empty-icon { font-size: 36px; margin-bottom: 8px; }

    /* ‚îÄ‚îÄ –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ‚îÄ‚îÄ */
    .detail-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
    .meta-table td:first-child { color: var(--text3); width: 160px; font-size: 12px; }
    .meta-table td { padding: 6px 0; border: none; }
    .meta-table tr:hover td { background: none; }

    /* ‚îÄ‚îÄ –ì—Ä–∞—Ñ–∏–∫ ‚îÄ‚îÄ */
    .chart-bar-wrap { display: flex; align-items: flex-end; gap: 4px; height: 80px; }
    .chart-bar-col { display: flex; flex-direction: column; align-items: center; flex: 1; gap: 4px; }
    .chart-bar { width: 100%; background: var(--accent); border-radius: 3px 3px 0 0; min-height: 2px; transition: background 0.2s; }
    .chart-bar:hover { background: #60a5fa; }
    .chart-label { font-size: 9px; color: var(--text3); }

    @media (max-width: 900px) {
      .nav { display: none; }
      .main { margin-left: 0; }
      .detail-grid { grid-template-columns: 1fr; }
      .grid-2 { grid-template-columns: 1fr; }
    }
  </style>
  {% block extra_head %}{% endblock %}
</head>
<body>

  <!-- ‚îÄ‚îÄ –ù–∞–≤–∏–≥–∞—Ü–∏—è ‚îÄ‚îÄ -->
  <nav class="nav">
    <div class="nav-logo">
      <div class="nav-logo-title">DOCROBOT EDI</div>
      <div class="nav-logo-sub">Gateway ‚Üí 1C</div>
    </div>
    <div class="nav-items">
      <div class="nav-section">
        <div class="nav-label">–û–±–∑–æ—Ä</div>
        <a href="{% url 'dashboard' %}" class="nav-item {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
          <span class="nav-icon">‚ñ¶</span> –î–∞—à–±–æ—Ä–¥
        </a>
      </div>
      <div class="nav-section">
        <div class="nav-label">–î–æ–∫—É–º–µ–Ω—Ç—ã</div>
        <a href="{% url 'documents' %}" class="nav-item {% if 'document' in request.resolver_match.url_name %}active{% endif %}">
          <span class="nav-icon">üìÑ</span> –î–æ–∫—É–º–µ–Ω—Ç—ã
        </a>
        <a href="{% url 'queue' %}" class="nav-item {% if request.resolver_match.url_name == 'queue' %}active{% endif %}">
          <span class="nav-icon">‚è≥</span> –û—á–µ—Ä–µ–¥—å 1–°
        </a>
      </div>
      <div class="nav-section">
        <div class="nav-label">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</div>
        <a href="{% url 'logs' %}" class="nav-item {% if request.resolver_match.url_name == 'logs' %}active{% endif %}">
          <span class="nav-icon">üìã</span> –õ–æ–≥–∏
        </a>
        <a href="{% url 'reports' %}" class="nav-item {% if request.resolver_match.url_name == 'reports' %}active{% endif %}">
          <span class="nav-icon">üìä</span> –û—Ç—á—ë—Ç—ã
        </a>
      </div>
      <div class="nav-section">
        <div class="nav-label">–°–∏—Å—Ç–µ–º–∞</div>
        <a href="{% url 'connections' %}" class="nav-item {% if request.resolver_match.url_name == 'connections' %}active{% endif %}">
          <span class="nav-icon">üîå</span> –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        </a>
        <a href="{% url 'settings' %}" class="nav-item {% if 'settings' in request.resolver_match.url_name %}active{% endif %}">
          <span class="nav-icon">üîß</span> –®–∞–±–ª–æ–Ω—ã XML
        </a>
        <a href="/admin/" class="nav-item">
          <span class="nav-icon">‚öô</span> Django Admin
        </a>
      </div>
    </div>
    <div class="nav-footer">v1.0 ¬∑ Docrobot KZ</div>
  </nav>

  <!-- ‚îÄ‚îÄ –ö–æ–Ω—Ç–µ–Ω—Ç ‚îÄ‚îÄ -->
  <div class="main">
    <div class="topbar">
      <div>
        <div class="topbar-title">{% block page_title %}Docrobot EDI{% endblock %}</div>
        <div class="topbar-sub">{% block page_sub %}{% endblock %}</div>
      </div>
      <div class="topbar-right">
        {% block topbar_actions %}{% endblock %}
      </div>
    </div>
    <div class="content">
      {% block content %}{% endblock %}
    </div>
  </div>

  <!-- ‚îÄ‚îÄ Toast ‚îÄ‚îÄ -->
  <div id="toast-container"></div>

  <script>
    function toast(msg, type = 'info') {
      const el = document.createElement('div');
      el.className = `toast toast-${type}`;
      el.textContent = msg;
      document.getElementById('toast-container').appendChild(el);
      setTimeout(() => el.remove(), 3500);
    }

    async function retryQueue(id, btn) {
      btn.disabled = true;
      btn.textContent = '...';
      try {
        const r = await fetch(`/api/retry/${id}/`, {
          method: 'POST',
          headers: { 'X-CSRFToken': getCookie('csrftoken') },
        });
        const d = await r.json();
        if (d.success) {
          toast('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ 1–°', 'success');
          setTimeout(() => location.reload(), 800);
        } else {
          toast(`–û—à–∏–±–∫–∞: ${d.error}`, 'error');
          btn.disabled = false;
          btn.textContent = '‚Ü∫ –ü–æ–≤—Ç–æ—Ä';
        }
      } catch(e) { toast('–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞', 'error'); btn.disabled = false; }
    }

    function getCookie(name) {
      const v = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
      return v ? v[2] : null;
    }
  </script>
  {% block extra_js %}{% endblock %}
</body>
</html>
